{% extends 'base.html.twig' %}

{% block title %} ChampyLight :: Control {% endblock %}

{% block body %}
<div class="container">

    <!-- HEADER -->
    <div class="row" id="header">
        <h1 class="col-xs-12" id="header_title">ChampyLight Controller</h1>
    </div>

    <form action="submit_values.php" method="POST">
        <!-- Command block to fire transiitons and set timer -->
        <div class="row" id="command">
                
            <!-- Fire transition -->
            <div class="col-sm-4 col-xs-12" id="fire_transition">
                <button type="submit" class="btn btn-default btn-lg">
                      <span class="glyphicon glyphicon-play" aria-hidden="true"> Fire transition</span>
                  </button>
            </div>
            
            <!-- Timer -->
            <div class="col-sm-8 col-xs-12" id="timer">
                <input id="slider_timer" 
                       type="text" 
                       data-slider-min="1" 
                       data-slider-max="1800" 
                       data-slider-step="1" />
                       <span id="slider_timer_msg"> 
                           <i class="fa fa-clock-o">  <span id="slider_timer_value">5</span>''</i>
                       </span>
            </div>

        </div>
        <!-- List of channels that are in the patch -->
        <div class="row">
      
        {% for key, channel in channels %}

        {# Computing values for coming channel #}
        {% set channel_no = channel.channel %}

        {# Standards for BW #}
        {% set data_slider_enabled = "false" %}
        {% set data_slider_red_value = 255 %}
        {% set data_slider_green_value = 255 %}
        {% set data_slider_blue_value = 255 %}
        {% set data_slider_white_value = 255 %}
        {% set data_slider_intensity_value = channel.intensity %}

        {# If is RGB, update #}
        {% if channel.type == TYPE_RGB %}
            {% set data_slider_enabled = "true" %}

            {% set data_slider_red_value = channels..intensity %}
            {% set data_slider_green_value = channels.{{ key + GREEN_INDEX }}.intensity %}
            {% set data_slider_blue_value = channels.{{ key + BLUE_INDEX }}.intensity %}
            {% set data_slider_white_value = channels.{{ key + WHITE_INDEX }}.intensity %}
            {% set data_slider_intensity_value = channels.{{ key + INTENSITY_INDEX }}.intensity %}

        {% endif %}

        {% endfor %}
            
            <div class="channel channel_{{ channel_no }} col-lg-4 col-sm-6 col-xs-12">
                <div class="channel_content row">
                    <div class="channel_side channel_side_left col-xs-2">
                        <div class="channel_no col-xs-12">
                            <i class="fa fa-sliders">  {{ channel_no }}</i>
                        </div>

                        <div class="colour col-xs-offset-2 col-xs-8" id="chan_col_{{ channel_no }}">
                            
                        </div>  
                        
                        <div class="val_int col-xs-12">
                            <p><i class="fa fa-bolt"> <span id="val_int_{{ channel_no }}">{{ data_slider_intensity_value }}</span></i></p>
                        </div>
                        
                    </div>
                    
                    <div class="sliders col-xs-8">
                        <p class="slider_red">
                        <input type="text" 
                               class="span2 channel_{{ channel_no }}" 
                               value="" 
                               data-slider-min="0" 
                               data-slider-max="255" 
                               data-slider-step="1" 
                               data-slider-value="{{ data_slider_red_value }}" 
                               data-slider-id="RC_{{ channel_no }}" 
                               id="R_{{ channel_no }}" 
                               data-slider-enabled="{{ data_enabled }}"
                               data-slider-handle="round" />
                        </p>
                        <p class="slider_green">
                        <input type="text" 
                               class="span2 channel_{{ channel_no }}" 
                               value="" 
                               data-slider-min="0" 
                               data-slider-max="255" 
                               data-slider-step="1" 
                               data-slider-value="{{ data_slider_green_value }}" 
                               data-slider-id="GC_{{ channel_no }}" 
                               id="G_{{ channel_no }}" 
                               data-slider-enabled="{{ data_enabled }}"
                               data-slider-handle="round" />
                        </p>
                        <p class="slider_blue">
                        <input type="text" 
                               class="span2 channel_{{ channel_no }}" 
                               value="" 
                               data-slider-min="0" 
                               data-slider-max="255" 
                               data-slider-step="1" 
                               data-slider-value="{{ data_slider_green_value }}" 
                               data-slider-id="BC_{{ channel_no }}" 
                               id="B_{{ channel_no }}" 
                               data-slider-enabled="{{ data_enabled }}"
                               data-slider-handle="round" />
                        </p>
                        <p class="slider_white">
                        <input type="text" 
                               class="span2 channel_{{ channel_no }}" 
                               value="" 
                               data-slider-min="0" 
                               data-slider-max="255" 
                               data-slider-step="1" 
                               data-slider-value="{{ data_slider_white_value }}" 
                               data-slider-id="WC_{{ channel_no }}" 
                               id="W_{{ channel_no }}" 
                               data-slider-enabled="{{ data_enabled }}"
                               data-slider-handle="round" />
                        </p>
                    </div>
                    
                    <div class="channel_side channel_side_right col-xs-2">
                        <div class="intensity col-xs-12">
                            <input id="int_{{ channel_no }}" 
                                   class="channel_{{ channel_no }}" 
                                   type="text" 
                                   data-slider-min="0" 
                                   data-slider-max="255" 
                                   data-slider-step="1" 
                                   data-slider-value="{{ data_slider_intensity_value }}" 
                                   data-slider-orientation="vertical"/>
                        </div>
                    </div>
                </div>
            </div>

            {% endfor %}
            <!-- Foreach loop end -->    
        </div>
    </form>

    <!-- FOOTER -->
    <div class="row" id="footer">
        <div class="col-xs-12 btn-group btn-group-lg" role="group">
            <button type="button" id="control_btn" class="disabled col-xs-6 btn btn-default">Control</button>
            <button type="button" id="patch_btn" class="col-xs-6 btn btn-default">Patch</button>
        </div>
    </div>

</div>
{% endblock %}

{% block javascripts %}

<!-- Scripts for sliders-->
<script type='text/javascript' src="{{ asset('bootstrap-slider/js/bootstrap-slider.js') }}"></script>
<script type='text/javascript' src="{{ asset('js/control.js') }}></script>

{% endblock %}

